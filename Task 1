#define _GNU_SOURCE             
#include <stdio.h>              
#include <stdlib.h>              

int main (int argc, char *argv[]) {
    FILE *fp;                    // File pointer for the input file

    // Check that exactly one file is provided
    if (argc != 2) {
        printf("Aww man, invalid number of arguments!!\n");
        return 1;
    }

    // Open the file for reading
    fp = fopen(argv[1], "r");
    if (fp == NULL) {
        // perror prints a system-generated error message
        perror("Aww man, unable to open file!!\n");
        return 1; 
    }

    char *buffer = NULL;         // Buffer for getline 
    size_t len = 0;              // Size of the buffer 
    int line_count = 0;          // Total number of lines in the file

    // First pass : Count how many lines are in the file
    while (getline(&buffer, &len, fp) != -1) {
        line_count++;
    }

    int start;
    // Find the starting line index to print the last two lines
    if (line_count > 2) {
        start = line_count - 2;
    } else {
        start = 0;               // If the file has less than 2 lines, print everything in it
    }

    rewind(fp);                  // Reset file pointer back to the beginning

    int index = 0;               // Tracks the current line number
    // Second pass: Print only the last two lines
    while (getline(&buffer, &len, fp) != -1) {
        if (index >= start) {
            printf("%s\n", buffer);
        }
        index++;
    }

    free(buffer);                // Free memory allocated by getline
    fclose(fp);                  

    return 0;                    
}
